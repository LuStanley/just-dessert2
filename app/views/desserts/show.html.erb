<hr>

<% if current_user.id == @dessert.user_id %>
  <%= link_to 'Edit', edit_dessert_path(@dessert) %> |
  <%= link_to 'Delete', dessert_path(@dessert), method: :delete, data: {confirm:"Are you sure?"} %> |
  <%= link_to '訂單狀況', dessert_orders_path(@dessert) %>
<% end %>

<h3><%= @dessert.name %></h3>

<p><%= image_tag @dessert.image.url if @dessert.image? %></p>

<p>創作者：
  <%= link_to user_path(@dessert.user) do %>
    <%= @dessert.user.name %>
  <% end %>
</p>

<p>Price: $ <%= @dessert.price %> / each</p>

<p>
  還有 <%= @dessert.amount %> 個集資成功
  <% if @dessert.amount != 0 %>
    <% if current_user.id != @dessert.user_id %>
      <%= link_to '立即贊助', new_dessert_order_path(@dessert) %>
    <% end %>
  <% end %>
</p>

<p>面交地點： <%= @dessert.location %></p>

<p>製作所需時間：<%= @dessert.production_time %></p>

<p>集資截止時間： <%= time_tag @dessert.excess_time %></p>

<p>預定面交時間： <%= time_tag @dessert.pick_time %></p>

<p>介紹： <%= simple_format @dessert.description %></p>

<hr>

<% @dessert.comments.each do |comment| %>
  <div>
    <h4><strong><%= comment.user.name %></strong></h4>
    <p><%= simple_format comment.content %></p>
    <p class="text-muted">
      <em><%= "about " + time_ago_in_words(comment.created_at) + " ago" %></em>
    </p>
  </div>
  <div>
    <% if current_user.admin? %>
      <%= link_to "Delete", dessert_comment_path(@dessert, comment), method: :delete, data: {confirm:"Are you sure?"} %>
    <% end %>
  </div>

  <% comment.replies.each do |reply| %>
    <div>
      <h4><strong><%= @dessert.user.name %></strong></h4>
      <p><%= simple_format reply.content %></p>
      <p class="text-muted">
        <em><%= "about " + time_ago_in_words(reply.created_at) + " ago" %></em>
      </p>
    </div>
    <div>
      <% if current_user.admin? %>
        <%= link_to "Delete", dessert_comment_reply_path(@dessert, comment, reply), method: :delete, data: {confirm:"Are you sure?"} %>
      <% end %>
    </div>
  <% end %>

  <% if current_user.id == @dessert.user_id %>
    <div class="container">
      <div class="row">
        <%= form_for [@dessert, comment, @reply] do |f| %>
          <div class="form-group">
            <%= f.text_area :content, placeholder: "回覆", class: "form-control" %>
          </div>
          <div class="form-group">
            <%= f.submit class: "btn btn-primary" %>
            <%= f.button "Cancel", type: :reset, class: "btn btn-default" %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
  <hr>
<% end %>

<% if current_user.id != @dessert.user_id %>
  <div class="container">
    <div class="row">
      <%= form_for [@dessert, @comment] do |f| %>
        <div class="form-group">
          <%= f.text_area :content, placeholder: "留個言吧", class: "form-control" %>
        </div>
        <div class="form-group">
          <%= f.submit class: "btn btn-primary" %>
          <%= f.button "Cancel", type: :reset, class: "btn btn-default" %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
<%= link_to '回到前台首頁', root_path %>
